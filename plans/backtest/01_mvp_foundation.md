# Checkpoint 1: MVP基础框架

**每次更新和修改子计划内容，都需要将必要信息同步到总计划中**

## 目标定义

建立最小可行的回测框架，能够运行S0静态策略的单赛季回测并产生基本结果。重点是**先跑起来**，而不是完美的设计。

## 要解决的核心问题

### 1. 时间数据的正确管理
**问题**: 如何确保回测时不会意外使用未来数据？
**挑战**: 历史数据需要按时间点切片，每个决策点只能看到当时可用的信息

### 2. 历史数据的获取和组织
**问题**: 如何有效加载和管理多赛季的历史数据？
**挑战**: 数据量大，格式可能不统一，需要验证完整性

### 3. 策略执行的基本框架
**问题**: 如何为策略提供标准化的执行环境？
**挑战**: 不同策略复杂度差异大，需要统一而灵活的接口

### 4. 结果的收集和基本分析
**问题**: 如何记录和分析策略执行结果？
**挑战**: 需要可比较的结果格式，支持后续深入分析

## 最小可行解决方案

### 数据管理方案
```
思路：简单直接的数据管理
- 选择1-2个历史赛季作为起点（如2023-24）
- 使用最直接的数据加载方式（可以是CSV，不一定非要Parquet）
- 实现基本的时间点数据过滤
- 先保证数据正确性，性能优化后续考虑
```

### 策略框架方案
```
思路：最简化的策略接口
- 策略就是一个函数：给定当前状态和可用数据，返回决策
- 决策格式简单明确：转会列表、首发11人、队长
- 不预设复杂的类继承结构，用duck typing
- S0策略作为第一个实现案例
```

### 执行引擎方案
```
思路：单线程的简单循环
- 对每个GW：加载数据 → 调用策略 → 记录决策 → 计算得分
- 错误处理从简，先保证主要流程能跑通
- 日志输出清晰，便于调试
- 状态管理简单直接
```

### 结果输出方案
```
思路：结构化但不复杂的输出
- 生成基本的JSON结果文件
- 包含每GW的决策和得分
- 生成简单的汇总统计
- 支持基本的可视化数据
```

## 技术实现考虑

### 数据结构设计
- 使用标准的Python数据结构（dict, list）和pandas DataFrame
- 避免过度抽象，优先可读性和简单性
- 数据验证从简，先保证主要流程

### 代码组织
```
src/backtest/
├── __init__.py
├── data/           # 数据加载和管理
├── strategies/     # 策略实现
├── engine/         # 执行引擎
└── analysis/       # 基本分析

scripts/backtest/
└── run_simple.py   # 简单的命令行入口
```

### 配置管理
- 使用简单的Python dict或YAML文件
- 配置项从少开始，逐步增加
- 重点配置：数据路径、赛季选择、输出路径

## 开发方法

### 📝 测试驱动的开发
1. **先写最简单的测试**：能加载一个GW的数据吗？
2. **实现最简单的代码**：让测试通过
3. **逐步增加测试场景**：多个GW，完整赛季
4. **重构和改进**：基于实际运行经验

### 🔍 增量式验证
- 每个功能都先用小数据集验证
- 对比手工计算结果确保正确性
- 逐步扩展到更大数据集

### 📊 数据驱动的决策
- 先理解现有数据的结构和特点
- 基于实际数据格式设计接口
- 性能瓶颈出现时再优化

## 预期产出

### 可运行的代码
- [ ] 能够加载单个赛季的历史数据
- [ ] 实现S0静态策略
- [ ] 运行完整的单赛季回测
- [ ] 生成基本的结果文件

### 验证结果
- [ ] S0策略的决策符合预期（使用固定阵容）
- [ ] 计算的得分与实际FPL得分一致
- [ ] 时间控制正确（没有使用未来数据）

### 可扩展架构
- [ ] 代码结构清晰，易于添加新策略
- [ ] 数据管理支持扩展到多赛季
- [ ] 结果格式支持后续深入分析

## 成功标准

### 功能标准
**核心指标**: 能够成功运行S0策略的2023-24赛季回测
- 每个GW生成合理的首发11人和队长选择
- 计算出的总分在合理范围内（如2000-2500分）
- 执行过程无崩溃，有清晰的进度输出

### 质量标准
**核心指标**: 代码清晰可维护，结果可验证
- 代码结构简单明了，新人能快速理解
- 关键功能有基本测试覆盖
- 能够追踪每个决策的来源和计算过程

### 扩展性标准
**核心指标**: 为后续开发奠定基础
- 添加新策略的成本低
- 扩展到多赛季的改动小
- 集成现有系统的路径清晰

## 常见陷阱和避免方法

### 🚫 过度设计
**陷阱**: 想要一开始就设计完美的架构
**避免**: 先实现最简单的可行方案，基于实际需求演进

### 🚫 完美主义
**陷阱**: 想要处理所有边界情况和异常
**避免**: 先处理主要流程，边界情况逐步完善

### 🚫 性能焦虑
**陷阱**: 担心性能问题而过早优化
**避免**: 先保证功能正确，性能问题出现时再解决

### 🚫 接口锁定
**陷阱**: 过早确定详细的接口定义
**避免**: 用数据结构定义契约，保持实现灵活性

## 技术决策记录

### 数据存储格式
**决策**: 暂时使用CSV/JSON，后续可升级到Parquet
**原因**: 简单直接，便于调试和验证
**影响**: 后续需要考虑性能优化

### 策略接口设计
**决策**: 使用简单的函数接口，不预设类继承
**原因**: 避免过度抽象，保持灵活性
**影响**: 可能需要后续重构为更正式的接口

### 错误处理策略
**决策**: 采用快速失败（fail-fast）原则
**原因**: 便于早期发现问题，简化调试
**影响**: 生产环境可能需要更优雅的错误处理

## 下一步计划

1. **数据探索** (1天): 深入了解现有历史数据的结构和格式
2. **S0策略实现** (1天): 实现最简单的静态策略
3. **基础执行引擎** (2天): 实现单线程的回测循环
4. **结果验证** (1天): 对比手工计算，确保正确性
5. **代码清理** (1天): 重构和文档，为下一阶段做准备

### 关键验证点
- [ ] 能够正确加载2023-24赛季GW1的数据
- [ ] S0策略能够基于固定阵容选择首发11人
- [ ] 计算的GW1得分与实际得分匹配
- [ ] 完整赛季回测能够正常完成
