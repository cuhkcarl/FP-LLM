# FP-ML Machine Learning Overhaul — Master Plan

## 背景
当前基线预测依赖位置内 z-score 与静态赛程修正，连续四轮在队长、排名与总分上出现系统性高估，同时缺乏对高分球员（尤其 premium）的覆盖。我们将以构建可学习的预测模块为核心，联动特征、策略与优化器调整，解决以下痛点：
1. **现实高分缺位**：黑名单与候选池策略排除顶级球员（Haaland/Salah 等），导致阵容缺乏爆点。
2. **预测校准不足**：expected_points 长期高估真实得分 11–18 分，并缺乏基于历史/逐轮的误差反馈。
3. **排序信号弱**：NDCG@11 在 GW2 ~ 0，排序无法突出真实高分，影响首发/队长选择。

## 总目标
- 交付一个以真实表现驱动的 ML 预测流水线，生成经误差校准的 expected_points。
- 以阶段性子计划跟踪：数据与特征扩展、模型训练与部署、策略与优化器的策略改造。
- 确保每个子计划的进展都能回写到此主计划，实现计划-执行-反馈闭环。

## 成功判据（Success Metrics）
- **预测质量**：RMSE 降至 ≤ 1.8，Spearman ≥ 0.7，NDCG@11 ≥ 0.35（滚动窗口，样本≥3 GW）。
- **策略表现**：首发 XI 实际得分在联赛平均分 ±5 范围内，且 captain 失误率（实际 captain < vice 分数）控制在 25% 内。
- **模块可维护性**：预测脚本支持 baseline/ML/blend 三模式切换，提供校准参数配置和回测入口。

## 工作分解
1. **数据与校准子计划** — `plans/SUBPLAN_DATA_AND_CALIBRATION.md`
   - 扩充数据源（逐轮历史、对手强度、event actuals），完成误差分析与特征工程落地。
2. **模型与训练子计划** — `plans/SUBPLAN_MODEL_AND_TRAINING.md`
   - 设计 ML 模型（初版可用 ridge/GBDT），实现训练、评估、模型落盘与预测 CLI 接入。
3. **策略与集成子计划** — `plans/SUBPLAN_STRATEGY_AND_INTEGRATION.md`
   - 调整优化器参数、队长/板凳逻辑、黑名单策略，确保 ML 分数能驱动阵容升级。

## 里程碑与时间线（可迭代调整）
- **M1：准备阶段（~1 周）** – 完成数据补齐、误差基线与初步特征定义。
- **M2：模型落地（~1-1.5 周）** – 完成模型训练、交叉验证、预测脚本改造。
- **M3：策略联动（~1 周）** – 优化器/队长逻辑更新，实测 2 个 GW 的表现并复盘。

## 治理流程
- 每个子计划文档为子项目的单一事实源，所有更新必须同步至本主计划的“工作分解/里程碑/成功判据”相关段落。
- 进展节奏：每完成关键动作，更新子计划并在主计划新增“状态回顾”小节（待创建）。
- 所有文档版本需通过 PR 或明确记录，确保可追踪。

